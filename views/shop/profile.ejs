<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Amado - Furniture Ecommerce Template | Home</title>

  <!-- Favicon  -->
  <link rel="icon" href="public/img/core-img/favicon.ico">

  <!-- Core Style CSS -->
  <link rel="stylesheet" href="public/css/core-style.css">
  <link rel="stylesheet" href="public/css/style.css">
  <link rel="stylesheet" href="public/css/profile.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
</head>

<body>
<div class="pf-container">
  <h1>My Profile</h1>
  <div class="pf-grid">
    <!-- SIDE -->
    <aside class="pf-side">
      <div class="pf-card">
        <div class="pf-profile">
          <div class="pf-avatar">
            <!-- Avatar -->
            <img src="<%= (user && user.profileImage) ? ('/uploads/' + user.profileImage) : 'https://images.unsplash.com/photo-1544723795-3fb6469f5b39?q=80&w=300' %>" alt="Avatar"/>
            <span class="pf-badge"><i class="fa-solid fa-crown"></i> <%= (user && user.membership) ? user.membership : 'Gold' %></span>
          </div>
          <div>
            <div class="pf-title"><%= user ? (user.fullName || 'Guest User') : 'Guest User' %></div>
            <div class="pf-meta">
              <span class="pf-online"></span>
              <span><i class="fa-regular fa-envelope"></i> <%= user ? user.email : 'you@example.com' %></span>
              <span><i class="fa-solid fa-phone"></i> <%= user ? (user.phone || '+91 90000 00000') : '+91 90000 00000' %></span>
            </div>
          </div>
        </div>
        <div class="pf-hr"></div>
        <nav class="pf-nav">
          <a class="active" href="#"><i class="fa-regular fa-user"></i> My Profile</a>
          <a href="#orders"><i class="fa-solid fa-box"></i> Orders <small>2</small></a>
          <a href="#addresses"><i class="fa-solid fa-location-dot"></i> Addresses</a>
          <a href="#payments"><i class="fa-regular fa-credit-card"></i> Payments</a>
          <a href="#wishlist"><i class="fa-regular fa-heart"></i> Wishlist <small>2</small></a>
          <a href="#security"><i class="fa-solid fa-shield-halved"></i> Security</a>
          <a href="/logout"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a>
        </nav>
      </div>

      <div class="pf-card pf-mt">
        <div class="pf-card-hd">
          <strong>Wallet & Rewards</strong>
          <span class="pf-tag"><i class="fa-solid fa-coins"></i> <%= user && typeof user.coins === 'number' ? user.coins : 1800 %> Coins</span>
        </div>
        <div class="pf-card-bd">
          <div class="pf-inline">
            <button class="pf-btn"><i class="fa-solid fa-gift"></i> Redeem</button>
            <button class="pf-btn"><i class="fa-solid fa-ticket"></i> Coupons</button>
            <button class="pf-btn"><i class="fa-solid fa-percent"></i> Deals</button>
          </div>
          <div class="pf-hr"></div>
          <div class="pf-small pf-muted">Referral</div>
          <div class="pf-inline">
            <code id="ref" class="pf-code"><%= user && user.referralCode ? user.referralCode : 'AMAD-8X2K9Q' %></code>
            <button class="pf-btn" id="copyRef"><i class="fa-regular fa-copy"></i> Copy</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="pf-main">
      <!-- Account -->
      <section class="pf-card" id="account">
        <div class="pf-card-hd"><strong>Account Details</strong><span class="pf-small pf-muted">Keep your info up to date</span></div>
        <div class="pf-card-bd">
          <!-- NOTE: This posts to /profile which your editProfile controller handles -->
          <form action="/profile" method="POST" enctype="multipart/form-data">
            <div class="pf-grid-2">
              <div>
                <label>Full Name</label>
                <input name="fullName" value="<%= user ? (user.fullName || '') : '' %>" placeholder="Your name"/>
              </div>
              <div>
                <label>Email</label>
                <input name="email" type="email" value="<%= user ? (user.email || '') : '' %>" placeholder="you@example.com"/>
              </div>
              <div>
                <label>Phone</label>
                <input name="phone" value="<%= user ? (user.phone || '') : '' %>" placeholder="+91…"/>
              </div>
              <div>
                <label>Date of Birth</label>
                <input name="dob" type="date" value="<%= (user && user.dob) ? new Date(user.dob).toISOString().split('T')[0] : '' %>"/>
              </div>
              <div>
                <label>Gender</label>
                <select name="gender">
                  <option <%= !user || !user.gender ? 'selected' : '' %>>Select</option>
                  <option <%= user && user.gender === 'Male' ? 'selected' : '' %>>Male</option>
                  <option <%= user && user.gender === 'Female' ? 'selected' : '' %>>Female</option>
                  <option <%= user && user.gender === 'Other' ? 'selected' : '' %>>Other</option>
                </select>
              </div>
              <div>
                <label>Profile Image</label>
                <!-- If your upload route is different, your JS can submit this to /profile/upload -->
                <input name="avatar" id="avatar" type="file" accept="image/*"/>
              </div>
            </div>
            <div class="pf-spacer-16"></div>
            <button class="pf-btn pf-gold" type="submit"><i class="fa-regular fa-floppy-disk"></i> Save Changes</button>
          </form>
        </div>
      </section>

      <!-- Orders (static - left as-is) -->
      <!--
      <section class="pf-card pf-mt" id="orders">
        ...
      </section>
      -->

      <!-- Addresses -->
      <section class="pf-card pf-mt" id="addresses">
        <div class="pf-card-hd">
          <strong>Saved Addresses</strong>
          <form action="/profile/addresses" method="POST" style="display:inline">
            <button class="pf-btn" type="submit"><i class="fa-solid fa-plus"></i> Add New</button>
          </form>
        </div>
        <div class="pf-card-bd">
          <div class="pf-grid-2">
            <% if (addresses && addresses.address && addresses.address.length) { %>
              <% addresses.address.forEach(function(addr){ %>
                <div class="pf-card pf-inner">
                  <div class="pf-card-bd">
                    <div class="pf-row-head" style="display:flex;justify-content:space-between;align-items:center">
                      <div class="pf-semibold"><%= addr.label || 'Address' %></div>
                      <% if (addr.isDefault) { %><span class="pf-tag">Default</span><% } %>
                    </div>
                    <div class="pf-muted pf-small pf-mt-6">
                      <%= (addr.fullName || (user && user.fullName) || 'Guest User') %>,
                      <%= addr.street || '' %><%= addr.street ? ',' : '' %>
                      <%= addr.city || '' %><%= addr.city ? ',' : '' %>
                      <%= addr.state || '' %> - <%= addr.zip || '' %>
                    </div>
                    <div class="pf-inline pf-mt">
                      <!-- Edit (POST to keep buttons; profile.js can intercept to open a modal) -->
                      <form action="/profile/addresses/edit?id=<%= addr._id %>" method="POST">
                        <button class="pf-btn" type="submit"><i class="fa-regular fa-pen-to-square"></i> Edit</button>
                      </form>
                      <!-- Delete -->
                      <form action="/profile/addresses/delete?id=<%= addr._id %>" method="POST">
                        <button class="pf-btn pf-danger" type="submit"><i class="fa-regular fa-trash-can"></i> Remove</button>
                      </form>
                    </div>
                  </div>
                </div>
              <% }) %>
            <% } else { %>
              <div class="pf-card pf-inner">
                <div class="pf-card-bd">
                  <div class="pf-muted pf-small">No saved addresses.</div>
                </div>
              </div>
            <% } %>
          </div>
        </div>
      </section>

      <!-- Payments (static) -->

      <!-- Wishlist (static) -->
      <!--
      <section class="pf-card pf-mt" id="wishlist">
        ...
      </section>
      -->

      <!-- Security -->
      <section class="pf-card pf-mt" id="security">
        <div class="pf-card-hd"><strong>Security</strong><span class="pf-small pf-muted">Manage password & devices</span></div>
        <div class="pf-card-bd">
          <form action="/profile/security" method="POST" class="pf-grid-2">
            <div>
              <label>Current Password</label>
              <input type="password" name="currentPassword" placeholder="••••••••"/>
            </div>
            <div>
              <label>New Password</label>
              <input type="password" name="newPassword" placeholder="Min 8 characters"/>
            </div>
            <div>
              <label>Confirm New Password</label>
              <input type="password" name="confirmPassword" placeholder="Re-enter new password"/>
            </div>
            <div>
              <label>Two-Factor Auth</label>
              <select name="tfa">
                <option <%= !user || !user.tfa || user.tfa === 'Off' ? 'selected' : '' %>>Off</option>
                <option <%= user && user.tfa === 'SMS' ? 'selected' : '' %>>SMS</option>
                <option <%= user && user.tfa === 'Authenticator App' ? 'selected' : '' %>>Authenticator App</option>
              </select>
            </div>
            <div class="pf-align-end">
              <button class="pf-btn pf-gold" type="submit"><i class="fa-solid fa-lock"></i> Update Security</button>
            </div>
          </form>
        </div>
      </section>
    </main>
  </div>
</div>

<script src="public/js/profile.js"></script>
<%- include('../partials/footer') %>


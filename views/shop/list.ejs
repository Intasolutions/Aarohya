<!-- ========== Simple Attractive Navbar (drop-in) ========== -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<link rel="stylesheet" href="/public/css/shop-neo.css">
 <link rel="stylesheet" href="/public/css/core-style.css" />
  <link rel="stylesheet" href="/public/css/style.css" />
<header class="nav-neo" role="banner">
  <div class="nav-neo__inner">
    <!-- Brand -->
    <a href="/" class="nav-neo__brand" aria-label="Amado Home">
      <span class="dot"></span> Amado
    </a>

    <!-- Mobile burger -->
    <button class="nav-neo__burger" id="navBurger" aria-label="Toggle menu" aria-expanded="false" aria-controls="navMenu">
      <span></span><span></span><span></span>
    </button>

    <!-- Menu -->
    <nav class="nav-neo__menu" id="navMenu" role="navigation">
      <a href="/"         class="<%= (typeof active!=='undefined' && active==='home')     ? 'active' : '' %>">Home</a>
      <a href="/shop"     class="<%= (typeof active!=='undefined' && active==='shop')     ? 'active' : '' %>">Shop</a>
      <a href="/wishlist" class="<%= (typeof active!=='undefined' && active==='wishlist') ? 'active' : '' %>">Wishlist</a>
      <a href="/cart"     class="<%= (typeof active!=='undefined' && active==='cart')     ? 'active' : '' %>">Cart</a>
      <a href="/checkout" class="<%= (typeof active!=='undefined' && active==='checkout') ? 'active' : '' %>">Checkout</a>
    </nav>

    <!-- Right utilities -->
    <div class="nav-neo__right">
      <form action="/shop" method="GET" class="nav-neo__search" role="search">
        <input type="text" name="q" placeholder="Search products…" value="<%= (filters && filters.q) ? filters.q : '' %>"/>
        <button type="submit" aria-label="Search"><i class="fa fa-search"></i></button>
      </form>
      <a class="nav-neo__icon" href="/wishlist" title="Wishlist"><i class="fa-regular fa-heart"></i></a>
      <a class="nav-neo__icon" href="/cart"     title="Cart"><i class="fa-solid fa-bag-shopping"></i></a>
    </div>
  </div>
</header>






<%
  // helpers for links that preserve filters
  function qs(extra) {
    const out = {};
    const keep = (k, v) => { if (v !== undefined && v !== null && v !== '') out[k] = v; };
    const f = filters || {};
    keep('category',    f.category);
    keep('subcategory', f.subcategory);
    keep('color',       f.color);
    keep('minPrice',    f.minPrice);
    keep('maxPrice',    f.maxPrice);
    keep('inStock',     f.inStock);
    keep('sort',        f.sort);
    keep('view',        f.view);
    keep('page',        f.page);
    if (extra) for (const k in extra) keep(k, extra[k]);

    const params = new URLSearchParams(out).toString();
    return params ? ('?' + params) : '';
  }

  const startIdx = pagination.totalCount ? (pagination.pageSize * (pagination.currentPage - 1)) + 1 : 0;
  const endIdx   = Math.min(pagination.totalCount, pagination.pageSize * pagination.currentPage);
  const colorMap = { "Silver":"#C0C0C0", "Gold":"#D4AF37", "Rose Gold":"#B76E79" };
%>

<div class="shop-neo">
  <!-- ===== Sidebar (sticky) ===== -->
  <aside class="shop-neo__aside">
    <!-- Card: Categories -->
    <section class="neo-card">
      <header class="neo-card__hd"><h6>Categories</h6></header>
      <div class="neo-card__bd">
        <ul class="neo-list">
          <li class="<%= !filters.category ? 'active' : '' %>">
            <a href="/shop<%= qs({ category:'', subcategory:'', page:1 }) %>">All</a>
          </li>
          <% categories.forEach(c => { %>
            <li class="<%= (filters.category === String(c._id)) ? 'active' : '' %>">
              <a href="/shop<%= qs({ category:c._id, subcategory:'', page:1 }) %>"><%= c.name %></a>
            </li>
          <% }) %>
        </ul>
      </div>
    </section>

    <!-- Card: Subcategories -->
    <section class="neo-card">
      <header class="neo-card__hd"><h6>Subcategories</h6></header>
      <div class="neo-card__bd">
        <div class="neo-radio">
          <label class="radio">
            <input type="radio" name="sc" <%= !filters.subcategory ? 'checked' : '' %>
              onclick="location.href='/shop<%= qs({ subcategory:'', page:1 }) %>'">
            <span>All</span>
          </label>
          <% subcategories.forEach(s => { %>
            <label class="radio">
              <input type="radio" name="sc" <%= filters.subcategory === String(s._id) ? 'checked' : '' %>
                onclick="location.href='/shop<%= qs({ subcategory:s._id, page:1 }) %>'">
              <span><%= s.name %></span>
            </label>
          <% }) %>
        </div>
      </div>
    </section>

    <!-- Card: Color -->
    <section class="neo-card">
      <header class="neo-card__hd"><h6>Color</h6></header>
      <div class="neo-card__bd">
        <div class="neo-colors">
          <% ['Silver','Gold','Rose Gold'].forEach(col => { %>
            <a href="/shop<%= qs({ color:col, page:1 }) %>"
               class="color-dot <%= filters.color === col ? 'active' : '' %>"
               title="<%= col %>" style="--dot:<%= colorMap[col] %>"></a>
          <% }) %>
          <a href="/shop<%= qs({ color:'', page:1 }) %>" class="color-dot all" title="All"></a>
        </div>
      </div>
    </section>

    <!-- Card: Price -->
    <section class="neo-card">
      <header class="neo-card__hd"><h6>Price</h6></header>
      <div class="neo-card__bd">
        <form action="/shop" method="GET" class="neo-price">
          <input type="hidden" name="category"    value="<%= filters.category %>">
          <input type="hidden" name="subcategory" value="<%= filters.subcategory %>">
          <input type="hidden" name="color"       value="<%= filters.color %>">
          <input type="hidden" name="inStock"     value="<%= filters.inStock || '' %>">
          <input type="hidden" name="sort"        value="<%= filters.sort %>">
          <input type="hidden" name="view"        value="<%= filters.view %>">
          <input type="hidden" name="page"        value="1">

          <div class="price-row">
            <div class="field">
              <label>Min</label>
              <input type="number" min="0" name="minPrice" value="<%= Number(filters.minPrice)||0 %>" placeholder="0">
            </div>
            <span class="sep">—</span>
            <div class="field">
              <label>Max</label>
              <input type="number" min="0" name="maxPrice" value="<%= Number(filters.maxPrice)||1000000 %>" placeholder="100000">
            </div>
          </div>
          <button class="btn btn-gold w-100" type="submit">Apply</button>
          <div class="range-text">₹<%= Number(filters.minPrice)||0 %> — ₹<%= Number(filters.maxPrice)||1000000 %></div>
        </form>
      </div>
    </section>

    <!-- Card: Availability + Reset -->
    <section class="neo-card">
      <div class="neo-card__bd">
        <label class="switch-row">
          <input type="checkbox" <%= filters.inStock === 'true' ? 'checked' : '' %>
                 onchange="location.href='/shop<%= qs({ inStock: (filters.inStock==='true'?'': 'true'), page:1 }) %>'">
          <span>In stock only</span>
        </label>
        <a class="btn btn-light w-100 mt-10" href="/shop">Reset filters</a>
      </div>
    </section>
  </aside>

  <!-- ===== Main ===== -->
  <main class="shop-neo__main">
    <!-- Topbar -->
    <div class="neo-topbar">
      <div class="count">SHOWING <%= startIdx %>-<%= endIdx %> OF <%= pagination.totalCount %></div>

      <div class="controls">
        <!-- Sort -->
        <form action="/shop" method="GET" class="control">
          <label>Sort by</label>
          <input type="hidden" name="category"    value="<%= filters.category %>">
          <input type="hidden" name="subcategory" value="<%= filters.subcategory %>">
          <input type="hidden" name="color"       value="<%= filters.color %>">
          <input type="hidden" name="minPrice"    value="<%= filters.minPrice %>">
          <input type="hidden" name="maxPrice"    value="<%= filters.maxPrice %>">
          <input type="hidden" name="inStock"     value="<%= filters.inStock || '' %>">
          <input type="hidden" name="page"        value="1">
          <input type="hidden" name="view"        value="<%= filters.view %>">
          <select name="sort" onchange="this.form.submit()">
            <option value="newest"   <%= filters.sort==='newest'   ? 'selected':'' %>>Newest</option>
            <option value="oldest"   <%= filters.sort==='oldest'   ? 'selected':'' %>>Oldest</option>
            <option value="priceAsc" <%= filters.sort==='priceAsc' ? 'selected':'' %>>Price: Low to High</option>
            <option value="priceDesc"<%= filters.sort==='priceDesc'? 'selected':'' %>>Price: High to Low</option>
          </select>
        </form>

        <!-- View size -->
        <form action="/shop" method="GET" class="control">
          <label>View</label>
          <input type="hidden" name="category"    value="<%= filters.category %>">
          <input type="hidden" name="subcategory" value="<%= filters.subcategory %>">
          <input type="hidden" name="color"       value="<%= filters.color %>">
          <input type="hidden" name="minPrice"    value="<%= filters.minPrice %>">
          <input type="hidden" name="maxPrice"    value="<%= filters.maxPrice %>">
          <input type="hidden" name="inStock"     value="<%= filters.inStock || '' %>">
          <input type="hidden" name="sort"        value="<%= filters.sort %>">
          <input type="hidden" name="page"        value="1">
          <select name="view" onchange="this.form.submit()">
            <option value="12" <%= Number(filters.view)===12 ? 'selected':'' %>>12</option>
            <option value="24" <%= Number(filters.view)===24 ? 'selected':'' %>>24</option>
            <option value="48" <%= Number(filters.view)===48 ? 'selected':'' %>>48</option>
            <option value="96" <%= Number(filters.view)===96 ? 'selected':'' %>>96</option>
          </select>
        </form>
      </div>
    </div>

    <!-- Grid -->
    <div class="neo-grid">
      <% if (products && products.length) { %>
        <% products.forEach(p => {
             const cover = (p.productImage && p.productImage.length) ? ('/public/' + p.productImage[0]) : '/public/img/product-img/product1.jpg';
             const hover = (p.productImage && p.productImage.length > 1) ? ('/public/' + p.productImage[1]) : cover;
             const priceNow = (typeof p.salePrice === 'number' && p.salePrice > 0) ? p.salePrice : p.regularPrice;
        %>
        <article class="neo-card neo-product">
          <a class="neo-product__img" href="/product/<%= p._id %>">
            <img src="<%= cover %>" alt="<%- p.productName %>" class="img-main">
            <img src="<%= hover %>" alt="<%- p.productName %>" class="img-hover">
            <span class="dot" title="<%= p.color %>" style="--dot:<%= colorMap[p.color] || '#ccc' %>"></span>
          </a>
          <div class="neo-product__meta">
            <div class="price">₹<%= priceNow %></div>
            <a href="/product/<%= p._id %>" class="name"><%- p.productName %></a>
          </div>
          <div class="neo-product__actions">
            <a class="btn btn-ghost" href="/product/<%= p._id %>"><i class="fa-regular fa-eye"></i> View</a>
            <form action="/cart/add/<%= p._id %>" method="POST">
              <input type="hidden" name="quantity" value="1">
              <input type="hidden" name="selectedColor" value="<%= p.color %>">
              <button type="submit" class="btn btn-gold"><i class="fa fa-cart-plus"></i> Add</button>
            </form>
          </div>
        </article>
        <% }) %>
      <% } else { %>
        <div class="neo-empty">
          <h5>No products found</h5>
          <p>Try changing your filters or resetting them.</p>
          <a class="btn btn-light" href="/shop">Reset filters</a>
        </div>
      <% } %>
    </div>

    <!-- Pagination -->
    <div class="neo-pager">
      <% if (pagination.totalPages > 1) { %>
        <% for (let i=1; i<=pagination.totalPages; i++) { %>
          <a class="page <%= i===pagination.currentPage ? 'active':'' %>"
             href="/shop<%= qs({ page:i }) %>"><%= i < 10 ? '0'+i : i %>.</a>
        <% } %>
      <% } %>
    </div>
  </main>
</div>

<!-- Newsletter (kept on theme) -->
<section class="newsletter-area section-padding-100-0">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-12 col-lg-6 col-xl-7">
        <div class="newsletter-text mb-100">
          <h2>Subscribe for a <span>25% Discount</span></h2>
          <p>Nulla ac convallis lorem, eget euismod nisl. Donec in libero sit amet mi vulputate consectetur.</p>
        </div>
      </div>
      <div class="col-12 col-lg-6 col-xl-5">
        <div class="newsletter-form mb-100">
          <form action="#" method="post">
            <input type="email" name="email" class="nl-email" placeholder="Your E-mail">
            <input type="submit" value="Subscribe">
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
<script>
  (function(){
    const burger = document.getElementById('navBurger');
    const menu   = document.getElementById('navMenu');
    if (burger && menu) {
      burger.addEventListener('click', () => {
        const open = menu.classList.toggle('open');
        burger.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    }
  })();
</script>
<!-- ========== /Navbar ========== -->
<%- include('../partials/footer') %>
